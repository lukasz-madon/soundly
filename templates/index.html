{% extends "base.html" %}
{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename = 'css/inlineplayer.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename = 'css/flashblock.css') }}" />
{% endblock %}
{% block content %}
  <div class="row">
    <div class="col-lg-8">
      <h2>1. Pick Music</h2>
        <form>
          <input type="text" class="form-control" placeholder="Search">
        </form>
        <br>
       <!-- <div id="sm2-container">
        SM2 flash goes here, but I think we can ship flask. audio html5 is now supported on 83% of browsers 
              <div class="spinner">
                <div class="rect1"></div>
                <div class="rect2"></div>
                <div class="rect3"></div>
                <div class="rect4"></div>
                <div class="rect5"></div>
              </div>  
       </div> -->
       <div class="row player-grid">
        {% for item in music %}
          <div class="player-item col-xs-6 col-sm-4">
            <a class="thumbnail" href="{{ item.url }}">
              <i class="fa fa-play"></i> 
                 <div class="txt text-right">
                  {{ item.artist }} <br>
                  <strong>{{ item.title }}</strong>
                 </div>
            </a>
          </div>
        {% endfor %} 
       </div>
       <small>You must choose, but choose wisely. </small>
    </div>
    <div class="col-lg-4">
      <div data-spy="affix" data-offset-top="1" data-offset-bottom="100">
        <h2>2. Upload Video</h2>
        <input type="file" name="file" id="file">
        <p id="status"></p>
        <h2>3. Add Music to video</h2>
        <h4>Your pick : <strong><span id="music_titile"></span></strong> </h4>
        <a class="btn btn-primary" href="#" id="add-music">Add music</a>
        <p> <small>Any second thoughts on the music? No? Add it!</small></p>
        <div id="ok"></div>
        <br>
        <small>While you're waiting try <a href="http://flapmmo.com/" target="_blank"> Flappy Bird MMO </a></small>
      </div>
    </div>
  </div>
{% endblock %}
{% block script %}
  {{ super() }}
<script type="text/javascript" src="{{ url_for('static', filename = 'js/soundmanager2.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename = 'js/inlineplayer.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename = 'js/s3upload.js') }}"></script>
<script type="text/javascript">
  var s3_video_url = null;
  function s3_upload(){
      var s3upload = new S3Upload({
          s3_object_name: '{{ channels["id"] }}' + '-',
          file_dom_selector: 'file',
          s3_sign_put_url: '/sign-s3/',
          onProgress: function(percent, message) {
            $('#status').html('Upload progress: ' + percent + '% ' + message);
          },
          onFinishS3Put: function(public_url) {
            s3_video_url = public_url;
            $('#status').html('Upload completed');
          },
          onError: function(status) {
            $('#status').html('Upload error: ' + status);
          }
      });
  }

  $().ready(function() {
      $('#file').on('change', s3_upload);
      $('#add-music').click(function(){
        if (inlinePlayer.lastSound === null) {
          alert('First pick the best music');
          return;
        }
        if (s3_video_url === null) {
          alert('You need to upload the video first');
          return;
        }
        var data = { video_url: s3_video_url, music_url: inlinePlayer.lastSound.url };
        $.ajax('process-video', {
          data : JSON.stringify(data),
          contentType : 'application/json',
          type : 'POST'
        });
        $('#ok').html('Your video will be available on your channels shortly. Don&apos;t forget to edit video description! <br> <img class="img-responsive" src="http://wearesocialmedia.gr/wp-content/uploads/2013/11/3879-animated_gif-chuck_norris-dodgeball-thumbs_up.gif">');
      });
  });
</script>
{% endblock %}
